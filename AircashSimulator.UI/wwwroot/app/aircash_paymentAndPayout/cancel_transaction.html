<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <h4>CancelTransaction</h4>

    <p>
        This method is called on the cash register in case casher needs to cancel payment (cashier's mistake, unpaid purchase, etc...) This method is intended for on-premise cancellation and can be called in a limited time interval after issuing the coupon (e.g. 5 minutes).<br />
    </p>

    <div class="table-responsive">
        <table class="table  table-active col-md-6">
            <thead>
                <tr>
                    <th>Environment</th>
                    <th>Method</th>
                    <th>URL</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><b>Test</b></td>
                    <td>
                        POST
                    </td>
                    <td>https://staging-api.aircash.eu/api/SalesPartner/CancelTransaction</td>
                </tr>
                <tr>
                    <td><b>Production</b></td>
                    <td>
                        POST
                    </td>
                    <td>https://api.aircash.eu/api/SalesPartner/CancelTransaction</td>
                </tr>
            </tbody>
        </table>
    </div>

    <uib-tabset>
        <uib-tab index="CancelTransaction-tab-0" heading="Request parameters" classes="nav-item">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Parameter</b></th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Required</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>PartnerID</b></td>
                            <td>String</td>
                            <td>Partner identifier</td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>PartnerTransactionID</b></td>
                            <td>String</td>
                            <td>
                                Partner’s unique identifier of the transaction
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>LocationID</b></td>
                            <td>String</td>
                            <td>
                                Sales partner location identifier, in case the partner wants to have reports per location, a unique location identifier should be sent for each location. If the partner wants the reports per something else, e.g. the user, he can send the user identifier etc.
                            </td>
                            <td>NO</td>
                        </tr>
                        <tr>
                            <td><b>Signature</b></td>
                            <td>String</td>
                            <td>
                                Signature to confirm that the partner is indeed making the request. Data to sign is LocationID={0}&PartnerID={1}&PartnerTransactionID={2}
                            </td>
                            <td>YES</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </uib-tab>
        <uib-tab index="CancelTransaction-tab-1" heading="Request example" classes="nav-item">
            <jsonformatter data="SalesPartner.CancelTransaction.RequestExample"></jsonformatter>
        </uib-tab>
        <uib-tab index="CancelTransaction-tab-2" heading="Signature" classes="nav-item">
            <pre>
Sequence template (values in red {value} need to be replaced with the values from the request)
<b style="font-size:12px;">
    PartnerID=<i class="text-danger">{partnerID}</i>&PartnerTransactionID=<i class="text-danger">{partnerTransactionID}</i>
</b>
Request example:
</pre>
            <jsonformatter data="SalesPartner.CancelTransaction.RequestExample"></jsonformatter>
            <pre>
Sequence:
LocationID=123&PartnerID=8f62c8f0-7155-4c0e-8ebe-cd9357cfd1bf&PartnerTransactionID=c88dcc81-8b43-4808-8ac5-da498bf08439
		
Signature:
caaKshrXnbLKujZI9XNo3arbHSVbx7zDQGMEnXQ7BBYMhBEgYNaM6xshqRZtpqT0qNI0pJmts+60m5vihXuHVojnQz/tXwcPs3plfbyRvB7qUMSKoQeljW06P6OhrfIfvzzvgpB7VBVN6+VyxZLpzk+mD0V2NXs4O+dHyqTA+MmqVjEdUNXrarxn/ywRCUJEB1hDmgLsD+yXVLxGQooO2jrHz7xIjN/4PUGy4jrznT6TJs0bW2L2P4Ko70Y5C2MOc8CDbPIMlDU9op54zPzs3sKHWA0ewOp4U636cByfdkhgQPMwvVj2G7rYTwcn3pT8kBzjNxYW79I76BTPPAOoASyFY+zD89uwA9Jqi+/lSGXDt6kjskVafGxM6dTMPHr6twxHCRwoPHYSZd0V36etc0ri1yAaoPxsIa86W/RiXT4ssv2IjYEUL1+uZbhP3HlzGED6ziLkH92d6I4Or82Ke5bT3+kX1zHUevYJkrTT6HJNL0wKsK1hLrWwSsFSOk9lWJbq0WFFp3PnlnOzIFTOvxsLew9MXLfqQksms95v+poRw24k4ARh1xAtHY1iyKTo/CUzhT1W2JpCbgIpTgXUWkoWrAthvW07JbCnwisBvAlJkt+pJ20WdgelUqLccxcsgafxa6byKh/LmMrn7ZIcSEiFEEEUQhPr+F5XdCxdhVI=

</pre>
        </uib-tab>
        <uib-tab index="CancelTransaction-tab-3" heading="200 OK Response example" classes="nav-item">
            Empty response
        </uib-tab>
        <uib-tab index="CancelTransaction-tab-4" heading="Error response messages" classes="nav-item">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Http response</th>
                            <th>Description</th>
                            <th>Error Code</th>
                            <th>Message</th>
                            <th>Solution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>401</b></td>
                            <td>
                                The partner is sending an unknown partner ID, or the signature is not valid.
                            </td>
                            <td>-</td>
                            <td>-</td>
                            <td>
                                Check all of the parameters that are being sent. If all parameters look good, contact Aircash support.
                            </td>
                        </tr>
                        <tr>
                            <td rowspan="4"><b>400</b></td>
                            <td rowspan="4">
                                An invalid request was made. The response will contain an error code and message
                            </td>
                            <td><b>7</b></td>
                            <td>Unable to cancel payout</td>
                            <td>
                                You can’t cancel a payout, only payment
                            </td>
                        </tr>
                        <tr>
                            <td><b>8</b></td>
                            <td>Transaction already canceled</td>
                            <td>
                                You can’t cancel a transaction that was already canceled.
                            </td>
                        </tr>
                        <tr>
                            <td><b>9</b></td>
                            <td>Transaction in wrong status</td>
                            <td>
                                The transaction is in wrong status and can’t be canceled
                            </td>
                        </tr>
                        <tr>
                            <td><b>10</b></td>
                            <td>Cancellation period expired</td>
                            <td>
                                You have a predefined timespan that you can cancel the transaction in.
                            </td>
                        </tr>
                        <tr>
                            <td><b>500</b></td>
                            <td>
                                Unexpected system error
                            </td>
                            <td>-</td>
                            <td>-</td>
                            <td>
                                Try again until the system recovers.
                            </td>
                        </tr>
                </table>
            </div>
            <p>
                Corner cases<br />
                In case of Aircash system not returning a response to a ConfirmTransaction call, or responding with an error 500, the sales partner system should check the transaction status in Aircash system by calling the CheckTransactionStatus method.
            </p>
        </uib-tab>
        <uib-tab index="CancelTransaction-tab-5" heading="Error response messages" classes="nav-item">
            <uib-tabset class="row tabs-left">
                <uib-tab index="CancelTransactionError-tab-1" heading="7 - Unable to cancel payout" classes="nav-item">
                    <div class="row col-12">
                        <div class="col-sm-6 overflow-auto" ng-if="!(errorCancelResponded && cancellCurrentErrorCode == 7)">
                            Request
                            <jsonformatter data="errorExamples.CancelTransaction.error7.request"></jsonformatter>

                            Sequence:
                            LocationID=123&PartnerID=e747a837-85d9-4287-a412-ffbb5d1b0ad8&PartnerTransactionID=289812f6-4f7b-4b43-b2df-77e6a803d946
                        </div>
                        <div class="col-sm-6" ng-if="!(errorCancelResponded && cancellCurrentErrorCode == 7)">
                            Response
                            <jsonformatter data="errorExamples.CancelTransaction.error7.response"></jsonformatter>
                        </div>
                        <div class="col-sm-6 overflow-auto" ng-if="errorCancelResponded && cancellCurrentErrorCode == 7">
                            Request ({{errorCancellRequestDateTimeUTC| date:'yyyy-MM-dd HH:mm:ss.sss'}})
                            <jsonformatter data="errorCancellRequest"></jsonformatter>

                            Sequence: {{errorCancellSequence}}<br />

                        </div>
                        <div class="col-sm-6" ng-if="errorCancelResponded && cancellCurrentErrorCode == 7">
                            Response ({{errorCancellResponseDateTimeUTC| date:'yyyy-MM-dd HH:mm:ss.sss'}})
                            <jsonformatter data="errorCancellResponse"></jsonformatter>
                        </div>
                    </div>
                    <button class="btn btn-primary mt-2" ng-click="cancelSimulateError(7)" ng-disabled="errorCancelServiceBusy">Simulate <i ng-if="errorCancelServiceBusy" class="fa fa-cog fa-spin"></i></button>
                    <button class="btn btn-white mt-2" ng-click="copyToClipboard(errorCancellRequestCopy)" ng-if="errorCancelResponded && cancellCurrentErrorCode == 7">Copy Request</button>
                </uib-tab>
                <uib-tab index="CancelTransactionError-tab-2" heading="8 - Transaction already canceled" classes="nav-item">
                    <div class="row col-12">
                        <div class="col-sm-6 overflow-auto" ng-if="!(errorCancelResponded && cancellCurrentErrorCode == 8)">
                            Request
                            <jsonformatter data="errorExamples.CancelTransaction.error8.request"></jsonformatter>

                            Sequence:
                            LocationID=123&PartnerID=e747a837-85d9-4287-a412-ffbb5d1b0ad8&PartnerTransactionID=a2853f63-2eeb-44a5-9440-8848f93f15da
                        </div>
                        <div class="col-sm-6" ng-if="!(errorCancelResponded && cancellCurrentErrorCode == 8)">
                            Response
                            <jsonformatter data="errorExamples.CancelTransaction.error8.response"></jsonformatter>
                        </div>
                        <div class="col-sm-6 overflow-auto" ng-if="errorCancelResponded && cancellCurrentErrorCode == 8">
                            Request ({{errorCancellRequestDateTimeUTC| date:'yyyy-MM-dd HH:mm:ss.sss'}})
                            <jsonformatter data="errorCancellRequest"></jsonformatter>

                            Sequence: {{errorCancellSequence}}<br />

                        </div>
                        <div class="col-sm-6" ng-if="errorCancelResponded && cancellCurrentErrorCode == 8">
                            Response ({{errorCancellResponseDateTimeUTC| date:'yyyy-MM-dd HH:mm:ss.sss'}})
                            <jsonformatter data="errorCancellResponse"></jsonformatter>
                        </div>
                    </div>
                    <button class="btn btn-primary mt-2" ng-click="cancelSimulateError(8)" ng-disabled="errorCancelServiceBusy">Simulate <i ng-if="errorCancelServiceBusy" class="fa fa-cog fa-spin"></i></button>
                    <button class="btn btn-white mt-2" ng-click="copyToClipboard(errorCancellRequestCopy)" ng-if="errorCancelResponded && cancellCurrentErrorCode == 8">Copy Request</button>
                </uib-tab>
                <uib-tab index="CancelTransactionError-tab-3" heading="9 - Transaction in wrong status" classes="nav-item">
                    Simulation not available.
                    <!--<div class="row col-12">
                        <div class="col-sm-6 overflow-auto" ng-if="!(errorCancelResponded && cancellCurrentErrorCode == 9)">
                            Request
                            <jsonformatter data="errorExamples.CancelTransaction.error9.request"></jsonformatter>

                            Sequence:
                            BarCode=AC23556664963151&LocationID=123&PartnerID=8f62c8f0-7155-4c0e-8ebe-cd9357cfd1bf&PartnerTransactionID=bc9219ca-6851-4cd2-a652-8d079d6d754e
                        </div>
                        <div class="col-sm-6" ng-if="!(errorCancelResponded && cancellCurrentErrorCode == 9)">
                            Response
                            <jsonformatter data="errorExamples.CancelTransaction.error9.response"></jsonformatter>
                        </div>
                        <div class="col-sm-6 overflow-auto" ng-if="errorCancelResponded && cancellCurrentErrorCode == 9">
                            Request ({{errorCancellRequestDateTimeUTC| date:'yyyy-MM-dd HH:mm:ss.sss'}})
                            <jsonformatter data="errorCancellRequest"></jsonformatter>

                            Sequence: {{errorCancellSequence}}<br />

                        </div>
                        <div class="col-sm-6" ng-if="errorCancelResponded && cancellCurrentErrorCode == 9">
                            Response ({{errorCancellResponseDateTimeUTC| date:'yyyy-MM-dd HH:mm:ss.sss'}})
                            <jsonformatter data="errorCancellResponse"></jsonformatter>
                        </div>
                    </div>
                    <button class="btn btn-primary mt-2" ng-click="cancelSimulateError(9)" ng-disabled="errorCancelServiceBusy">Simulate <i ng-if="errorCancelServiceBusy" class="fa fa-cog fa-spin"></i></button>
                    <button class="btn btn-white mt-2" ng-click="copyToClipboard(errorCancellRequestCopy)" ng-if="errorCancelResponded && cancellCurrentErrorCode == 9">Copy Request</button>-->
                </uib-tab>
                <uib-tab index="CancelTransactionError-tab-4" heading="10 - Cancellation period expired" classes="nav-item">
                    Simulation not available.
                    <!--<div class="row col-12">
                        <div class="col-sm-6 overflow-auto" ng-if="!(errorCancelResponded && cancellCurrentErrorCode == 10)">
                            Request
                            <jsonformatter data="errorExamples.CancelTransaction.error10.request"></jsonformatter>

                            Sequence:
                            BarCode=AC19637316401565&LocationID=123&PartnerID=8f62c8f0-7155-4c0e-8ebe-cd9357cfd1bf&PartnerTransactionID=7aed09af-2bc2-406d-8536-af11a3fdb06e
                        </div>
                        <div class="col-sm-6" ng-if="!(errorCancelResponded && cancellCurrentErrorCode == 10)">
                            Response
                            <jsonformatter data="errorExamples.CancelTransaction.error10.response"></jsonformatter>
                        </div>
                        <div class="col-sm-6 overflow-auto" ng-if="errorCancelResponded && cancellCurrentErrorCode == 10">
                            Request ({{errorCancellRequestDateTimeUTC| date:'yyyy-MM-dd HH:mm:ss.sss'}})
                            <jsonformatter data="errorCancellRequest"></jsonformatter>

                            Sequence: {{errorCancellSequence}}<br />

                        </div>
                        <div class="col-sm-6" ng-if="errorCancelResponded && cancellCurrentErrorCode == 10">
                            Response ({{errorCancellResponseDateTimeUTC| date:'yyyy-MM-dd HH:mm:ss.sss'}})
                            <jsonformatter data="errorCancellResponse"></jsonformatter>
                        </div>
                    </div>
                    <button class="btn btn-primary mt-2" ng-click="cancelSimulateError(10)" ng-disabled="errorCancelServiceBusy">Simulate <i ng-if="errorCancelServiceBusy" class="fa fa-cog fa-spin"></i></button>
                    <button class="btn btn-white mt-2" ng-click="copyToClipboard(errorCancellRequestCopy)" ng-if="errorCancelResponded && cancellCurrentErrorCode == 10">Copy Request</button>-->
                </uib-tab>
            </uib-tabset>
        </uib-tab>
        <uib-tab index="CancelTransaction-tab-6" heading="Try it out" classes="nav-item">
            <div class="row">
                <div class="col-md-4">
                    <br />
                    <p>Recent transactions:</p>
                    <div>
                        <div class="table-responsive">
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped table-condensed">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Transaction ID</th>
                                            <th>Amount</th>
                                            <th>LocationID</th>
                                            <th>Cancel</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-if="cancelTotalLoaded == 0 && !cancelBusy">
                                            <td colspan="12" align="center">
                                                <i>No data</i>
                                            </td>
                                        </tr>
                                        <tr ng-repeat="transaction in cancelTransactions">
                                            <td>{{$index + 1}}.</td>
                                            <td>{{transaction.transactionId}}</td>
                                            <td>{{transaction.amount | number:2}}</td>
                                            <td>{{transaction.pointOfSaleId}}</td>
                                            <td style="text-align: center; vertical-align: inherit">
                                                <button class="btn btn-danger fa fa-ban" ng-click="cancelTransaction(transaction.transactionId, transaction.pointOfSaleId)"></button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <load-more total-loaded="cancelTotalLoaded" out="cancelLoadMore"></load-more>
                    </div>
                </div>
                <div class="col-md-0.5"></div>
                <br />
                <div ng-if="cancelTransactionServiceResponded" class="col-md-4">
                    Request({{cancelTransactionRequestDateTimeUTC | date:'yyyy-MM-dd HH:mm:ss.sss'}})
                    <jsonformatter data="cancelTransactionServiceRequest"></jsonformatter>
                    Sequence: {{cancelTransactionSequence}}
                </div>
                <div ng-if="cancelTransactionServiceResponded" class="col-md-3">
                    Response ({{cancelTransactionRequestDateTimeUTC | date:'yyyy-MM-dd HH:mm:ss.sss'}})
                    <jsonformatter data="cancelTransactionServiceResponse"></jsonformatter>
                </div>
            </div>
        </uib-tab>
    </uib-tabset>
    <hr />


    <hr />

</body>
</html>