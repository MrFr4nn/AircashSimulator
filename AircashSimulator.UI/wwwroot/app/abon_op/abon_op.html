<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body>
    <div style="width: 100%">
        <h1>Intro</h1>
        <br />
        <div class="row">
            <div class="col-md-12">
                <p>
                    <a href="https://abon.cash/">Aircash A-bon</a> is a platform intended for users that wish to make payments to their accounts (betting sites, parking services, GSM topups etc.) via paper vouchers that can be bought at cash registers, i.e. points of sales of Aircash Sales Partners (kiosks, gas stations, etc.). 
                </p>
                <p>
                    From the Online Provider's perspective: the user logs in to a website or
                    a mobile app of an Online Provider (e.g. a booking site), and chooses to
                    deposit money via an Aircash A-bon voucher. He enters the 16-digit
                    code from the coupon he bought, and confirms the transaction of
                    funds to an Online Provider account. The funds are deposited to the
                    user's online account, and the coupon gets expended and can no
                    longer be used.
                </p>
                <p>
                    An example of an Aircash a-bon is shown <a href="" ng-click="showCoupon()">here</a>.
                </p>
            </div>
        </div>
        <hr />
        <h1>Technical integration aspects</h1>
        <br />
        <h4>Security and authentication</h4>
        <p>
            Aircash A-bon system exposes a REST API.
        </p>
        <p>
            The API is accessed via HTTPS protocol (secured by a TLS certificate).
        </p>
        <p>
            Each request towards Aircash A-bon API has to be digitally signed. This ensures non-repudiation of every request, as well as authentication.
        </p>
        <p>
            Certificate used for signing are generated as described in the <a href="https://dev-simulator.aircash.eu/#!/app/signature">Signature</a> chapter. 
        </p>
        <p>
            Each method has a special ProviderId parameter. This is a GUID type parameter that's generated by the Aircash team and delivered to each Online Provider separately.
        </p>
        <p>
            The partners are provided with an integration environment (staging) where it is possible to test all of the
            methods for integration. Integration details of the A-bon services are described in
            detail in the following chapters.
        </p>

        <br />
        <h4>Checkbox – I accept A-bon Terms & Conditions</h4>
        <p>
            In order for the users to use A-bon services on the Online Provider's website, they have to accept the
            terms and conditions beforehand.
        </p>
        <p>
            Every Online Provider is obliged to add a checkbox for the A-bon terms and conditions, which is by
            default always checked.
        </p>
        <p>
            The checkbox has to contain a link to A-bon Terms and Conditions:
        </p>
        <div class="note note-gray-400 col-md-8">
            <div class="note-content">
                <code>
                    &lta href="https://abon.cash/terms-conditions-en/" rel="nofollow"&gtI accept the A-bon Terms&Conditions&lt/a&gt
                </code>
            </div>
        </div>

        <hr />

        <h1>Online Provider API</h1>
        <br />
        <h4>ValidateCoupon</h4>
        <p>
            ValidateCoupon method allows you to check the coupon status, value and whether it is valid. Once you
            check the coupon validity and in case it is valid, you can call the ConfirmTransaction method to use that
            coupon.
        </p>

        <table class="table table-active col-md-6">
            <thead>
                <tr>
                    <th>Environment</th>
                    <th>Method</th>
                    <th>URL</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><b>Test</b></td>
                    <td>
                        POST
                    </td>
                    <td>https://staging-a-bon.aircash.eu/rest/api/OnlineProvider/ValidateCoupon</td>
                </tr>
                <tr>
                    <td><b>Production</b></td>
                    <td>
                        POST
                    </td>
                    <td>https://a-bon.aircash.eu/rest/api/OnlineProvider/ValidateCoupon</td>
                </tr>
            </tbody>
        </table>
        <br />
        <uib-tabset active="active">
            <uib-tab index="request-tab-0" heading="Request parameters" classes="nav-item">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Parameters</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Required</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>CouponCode</b></td>
                            <td>string</td>
                            <td>
                                16 digit coupon code that the user enters in the Merchant's web interface
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>ProviderId</b></td>
                            <td>string</td>
                            <td>
                                Unique partner identifier (per currency) provided by Aircash
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>Signature</b></td>
                            <td>string</td>
                            <td>
                                A sequence that has been digitally signed with the
                                Merchant's private signature, used for authentication
                            </td>
                            <td>YES</td>
                        </tr>
                    </tbody>
                </table>
            </uib-tab>
            <uib-tab index="request-tab-1" heading="Request example" classes="nav-item">
                <json-formatter open="1" json=validateCouponRequestExample></json-formatter>
            </uib-tab>
            <uib-tab index="request-tab-2" heading="Signature" classes="nav-item">
                <pre>
Request example:
                    <json-formatter open="1" json=validateCouponRequestExample></json-formatter>

Sequence:
CouponCode=5460446045144493&ProviderId=8f62c8f0-7155-4c0e-8ebe-cd9357cfd1bf

Signature:
BPz2mGu8UG89zpFZYdpbESrR4H4mA7cfWJBuyXWLtYJoQShHYQiMklof7NwNy/9lm0sC+PI7J99C/AhleCPrzeF4aYxYXMM5wg+0zMwOPTq/8uqnAmORreYqt5IcpnPxYryXEGpak/NNP3fqH911W4XAKJAurBSv5M/CxV+AC4v8GGkMKZPklH3GKReVDqsy3IP3GK1xnSEoz41h+qL7Ou2qjcEwE9KqDplaejDWFc9DB9ZxrB9+OZHds/rE1uGPfuqyGMgzv9zdsbeXYn2LvPjnvaHWYRPUDkwt3NlhYegayakxP49S4jTYAHNuDNboQVe81glnSawo1cF1T6SG7w3U6VnnKv6cdslHt+UB4xW0gTe3WDeCAUe6+W6LFeJY1dbYVz4x4PKvTFml6um6Qp8o1F1UfN/MemHojHwK0NXgtHpEyB1NvY5UyMJAIRZinMVxWDDCBFFwSp0VlAYx2mKUP60Y4HR9c/7MBh5wHVTFODQoN83h21sRtINntvm3GZRCtWgH0Xx8MOAi0UjgsYribLtxESsao4DMy06VxcokVNI4r6fqbzKYd0g+tF1kTRV0ZXeqK1PiDTyEzBxxakXnhOPUHf+E8B+zBpJrdNQPjyytVHMosjFTEpLI3HjpKslD0bFdk5Y+oWkYwMktHy1B9KMl5OraM4fZufrviCQ=
</pre>
            </uib-tab>
            <uib-tab index="request-tab-3" heading="Response parameters" classes="nav-item">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Parameters</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>CouponValue</b></td>
                            <td>decimal</td>
                            <td>
                                Coupon value
                            </td>
                        </tr>
                        <tr>
                            <td><b>IsValid</b></td>
                            <td>bool</td>
                            <td>
                                Status of the coupon's validity
                            </td>
                        </tr>
                        <tr>
                            <td><b>ISOCurrency</b></td>
                            <td>string</td>
                            <td>
                                ISO 4217 code of currency
                            </td>
                        </tr>
                        <tr>
                            <td><b>ProviderTransactionId</b></td>
                            <td>string</td>
                            <td>
                                Transaction identifier in the Online Provider system (has value
                                only if the coupon has been used)
                            </td>
                        </tr>
                        <tr>
                            <td><b>SalePartnerId</b></td>
                            <td>string</td>
                            <td>
                                Id of the point of sale - where the coupon was bought
                            </td>
                        </tr>
                        <tr>
                            <td><b>IsoCountryCode</b></td>
                            <td>string</td>
                            <td>
                                ISO 3166 standard – Codes for the representation of names of countries and their subdivisions (e.g. HR, DE, RO ...)
                            </td>
                        </tr>
                        <tr>
                            <td><b>OriginalISOCurrency</b></td>
                            <td>string</td>
                            <td>
                                ISO 4217 code of the currency that the coupon was originally
                                bought in
                            </td>
                        </tr>
                        <tr>
                            <td><b>OriginalCouponValue</b></td>
                            <td>decimal</td>
                            <td>
                                Coupon value in the currency that the coupon was originally
                                bought in
                            </td>
                        </tr>
                    </tbody>
                </table>
            </uib-tab>
            <uib-tab index="request-tab-4" heading="200 OK Response example" classes="nav-item">
                <json-formatter open="1" json=validateCouponResponseExample></json-formatter>
            </uib-tab>
            <uib-tab index="request-tab-5" heading="Error response messages" classes="nav-item">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Http response</th>
                            <th>Description</th>
                            <th>Error Code</th>
                            <th>Message</th>
                            <th>Aditional data</th>
                            <th>Solution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>400</b></td>
                            <td>An invalid request was made. The response will contain an error code, message and optionally additionalData.</td>
                            <td>
                                <b>1</b><br />
                                <b>2</b><br />
                                <b>3</b><br />
                                <b>4</b><br />
                            </td>
                            <td>
                                Invalid ProviderId<br />
                                Invalid Signature<br />
                                Invalid Coupon Code<br />
                                Conversion Module Error<br />
                            </td>
                            <td>
                                -<br />
                                -<br />
                                -<br />
                                -<br />
                            </td>
                            <td>
                                The response will contain an error code,
                                message and optionally additionalData.
                            </td>
                        </tr>
                        <tr>
                            <td><b>500</b></td>
                            <td>An unknown error occured</td>
                            <td>-</td>
                            <td>Unknown error has occurred</td>
                            <td>-</td>
                            <td>
                                Contact Aircash support
                            </td>
                        </tr>
                    </tbody>
                </table>
            </uib-tab>            
            <uib-tab index="request-tab-7" heading="Error response example" classes="nav-item">
                <json-formatter open="1" json=validateCouponErrorResponseExample></json-formatter>
            </uib-tab>
            <uib-tab index="request-tab-8" heading="Try it out" classes="nav-item">
                <div class="row">
                    <div class="col-md-2">
                        <form action="/" method="POST" name="transactionForm0">
                            <fieldset>
                                <div class="mb-3">
                                    <label class="form-label" for="exampleInputEmail1">Coupon code</label>
                                    <input ng-model="validateCouponModel.couponCode" class="form-control" type="text" placeholder="Enter coupon code" ng-required="true">
                                </div>
                                <button ng-click="validateCoupon()" class="btn btn-primary w-100px me-5px" ng-disabled="validateBusy || transactionForm0.$invalid">Validate <i ng-if="validateBusy" class="fa fa-cog fa-spin"></i></button>
                            </fieldset>
                        </form>
                    </div>
                    <br />
                    <div ng-hide="!validateResponded" class="col-md-4">
                        Request ({{ValidateRequestDateTimeUTC | date:'yyyy-MM-dd HH:mm:ss.sss'}})
                        <json-formatter open="1" json=ValidateServiceRequestObject></json-formatter>
                        Sequence: {{sequenceValidate}}
                    </div>
                    <div ng-hide="!validateResponded" class="col-md-4">
                        Response ({{ValidateResponseDateTimeUTC | date:'yyyy-MM-dd HH:mm:ss.sss'}})
                        <json-formatter open="1" json=ValidateServiceResponseObject></json-formatter>
                    </div>
                </div>
            </uib-tab>
        </uib-tabset>
        <br />
        <h4>ConfirmTransaction</h4>
        <p>
            Method that’s used to confirm the transfer of funds to the user’s online account.
        </p>
        <table class="table table-active col-md-6">
            <thead>
                <tr>
                    <th>Environment</th>
                    <th>Method</th>
                    <th>URL</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><b>Test</b></td>
                    <td>
                        POST
                    </td>
                    <td>https://staging-a-bon.aircash.eu/rest/api/OnlineProvider/ConfirmTransaction</td>
                </tr>
                <tr>
                    <td><b>Production</b></td>
                    <td>
                        POST
                    </td>
                    <td>https://a-bon.aircash.eu/rest/api/OnlineProvider/ConfirmTransaction</td>
                </tr>
            </tbody>
        </table>
        <br />
        <uib-tabset>
            <uib-tab index="request-tab-0" heading="Request parameters" classes="nav-item">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Parameters</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Required</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>CouponCode</b></td>
                            <td>string</td>
                            <td>
                                16 digit coupon code that the user enters in the Online
                                Provider's web interface
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>ProviderId</b></td>
                            <td>string</td>
                            <td>
                                Unique partner identifier (per currency) provided by Aircash
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>ProviderTransactionId</b></td>
                            <td>string</td>
                            <td>
                                Transaction identifier in the Online Provider system
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>UserId</b></td>
                            <td>string</td>
                            <td>
                                Unique user identifier in the Online Provider system
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>Signature</b></td>
                            <td>string</td>
                            <td>
                                A sequence that has been digitally signed with the
                                provider's private signature, used for authentication
                            </td>
                            <td>YES</td>
                        </tr>
                    </tbody>
                </table>
            </uib-tab>
            <uib-tab index="request-tab-1" heading="Request example" classes="nav-item">
                <json-formatter open="1" json=confirmTransactionRequestExample></json-formatter>
            </uib-tab>
            <uib-tab index="request-tab-2" heading="Signature" classes="nav-item">
                <pre>
Request example:
                    <json-formatter open="1" json=confirmTransactionRequestExample></json-formatter>

Sequence:
CouponCode=5460446045144493&ProviderId=8f62c8f0-7155-4c0e-8ebe-cd9357cfd1bf&ProviderTransactionId=d711c31b-9e20-48dd-a749-91778627b569&UserId=574f32a7-4ecb-48b2-9723-ac660b9c835d

Signature:
CVrMFUqDzgk8FIu7hT29Prcek9ptqsjIUCu1gRK/5BxsUgRWs+XmyYCWrvYTl3HdKU/OdSPTkpZdsxb1NpdTWhENuyLaQKHOfUj3s6esS7meVr5Cfhc4g2QXrHUyz/vajS3p8qd/uYt7ZK+i3oEIAiKKcLuCMevtiFtIDeMAXUCzCO5CD9wIey7rfVEWI+Qsf2ffhs8jM4KCjsjnSvovipdDzcj6D4npUcrxW8YduYnFatoByug71dybZSAqs8kbEFbDtcn6QipETXXHYdo0QG/JieqhjmRVe4gjdgL/h2uV9pMRLjln83sB9WwcKnVZR1DoRywsiRXrSEdvAyNIOVrgkxCHaf4VEIUg9rDBWwevYi8jC1c29hUwXhtvtDK1Cf5kA9PSF0qINNeACFz7WsLLt2UkB8lgFH62wz+f640nkScLW9tUB+NSVK6J5P5dSu89TF4U+8UNWXaQfn9ZqLtVU8yrxYKk3PDgtcnzNr6FOVTDTBee2drxupWr3NUy41BOa7IRgbOFJGRqLqP3MLInWGkKgmBhR5mjBvDHjA7H+63beko6XFw3pIxNawKNz+4axaY6XZGVxo7C9zvpWS7a/sHyzF/8Wx9L3dOb2d8K5qxsa8PU9iqSi9USOa5Xt2g7oy2IPTH/msAzBh6czzp2pbFxj0wMPTqjfKKelQM=
</pre>
            </uib-tab>
            <uib-tab index="request-tab-3" heading="Response parameters" classes="nav-item">
                <table class="table table-hover">
                    <thead>                        
                        <tr>
                            <th>Parameters</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>CouponValue</b></td>
                            <td>decimal</td>
                            <td>
                                Coupon value
                            </td>
                        </tr>
                        <tr>
                            <td><b>ISOCurrency</b></td>
                            <td>string</td>
                            <td>
                                ISO 4217 code of the currency
                            </td>
                        </tr>
                        <tr>
                            <td><b>ProviderTransactionId</b></td>
                            <td>string</td>
                            <td>
                                Transaction identifier in the Online Provider system (has value
                                only if the coupon has been used)
                            </td>
                        </tr>
                    </tbody>
                </table>
            </uib-tab>
            <uib-tab index="request-tab-4" heading="200 OK Response example" classes="nav-item">
                <json-formatter open="1" json=confirmTransactionResponseExample></json-formatter>
            </uib-tab>
            <uib-tab index="request-tab-5" heading="Error response messages" classes="nav-item">
                <table class="table table-hover">
                    <thead>
                        <tr>                            
                            <th>Http response</th>
                            <th>Description</th>
                            <th>Error Code</th>
                            <th>Message</th>
                            <th>Aditional data</th>
                            <th>Solution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>400</b></td>
                            <td>
                                An invalid request was made. The response will contain an error code, message and optionally additionalData.
                            </td>
                            <td>
                                <b>1</b><br />
                                <b>2</b><br />
                                <b>3</b><br />
                                <b>4</b><br />
                                <b>5</b><br />
                            </td>
                            <td>
                                Invalid ProviderId<br />
                                Invalid Signature<br />
                                Invalid Coupon Code<br />
                                Coupon Already Used<br />
                                Conversion Module Error<br />
                            </td>
                            <td>
                                -<br />
                                -<br />
                                -<br />
                                ISOCurrency, CouponValue, ProviderTransactionId<br />
                                -<br />
                            </td>
                            <td>
                                The response will contain an error code,
                                message and optionally additionalData.
                               
                            </td>
                        </tr>                       
                        <tr>
                            <td><b>500</b></td>
                            <td>An unknown error occured</td>
                            <td>-</td>
                            <td>Unknown error has occurred</td>
                            <td>-</td>
                            <td>
                                Contact Aircash support
                            </td>
                        </tr>
                    </tbody>
                </table>
            </uib-tab>
            <uib-tab index="request-tab-7" heading="Error response example" classes="nav-item">
                <json-formatter open="2" json=confirmTransactionErrorResponseExample></json-formatter>
            </uib-tab>
            <uib-tab index="request-tab-8" heading="Try it out" classes="nav-item">
                <div class="row">
                    <div class="col-md-2">
                        <form action="/" method="POST" name="transactionForm1">
                            <fieldset>
                                <div class="mb-3">
                                    <label class="form-label" for="exampleInputEmail1">Coupon code</label>
                                    <input ng-model="confirmTransactionModel.couponCode" class="form-control" type="text" placeholder="Enter coupon code" ng-required="true">
                                </div>
                                <button ng-click="confirmTransaction()" class="btn btn-primary w-100px me-5px" ng-disabled="confirmBusy  || transactionForm1.$invalid">Confirm transaction <i ng-if="confirmBusy" class="fa fa-cog fa-spin"></i></button>
                            </fieldset>
                        </form>
                    </div>
                    <br />
                    <div ng-hide="!confirmResponded" class="col-md-5">
                        Request ({{ConfirmRequestDateTimeUTC | date:'yyyy-MM-dd HH:mm:ss.sss'}})
                        <json-formatter open="1" json=ConfirmServiceRequestObject></json-formatter>
                        Sequence: {{sequenceConfirm}}
                    </div>
                    <div ng-hide="!confirmResponded" class="col-md-3">
                        Response ({{ConfirmResponseDateTimeUTC | date:'yyyy-MM-dd HH:mm:ss.sss'}})
                        <json-formatter open="1" json=ConfirmServiceResponseObject></json-formatter>
                    </div>
                </div>
            </uib-tab>
        </uib-tabset>


        <hr />
        <div class="chapter">
            <div class="technical-integration-aspects-container">
                <h1>Edge cases</h1>
                <br />
                <h4>ConfirmTransaction method – invalid or no response</h4>
                <p>
                    In the case of an unsuccessful ConfirmTransaction call, the following error recovery methods should be
                    applied:
                </p>
                <ol>
                    <li>Call ConfirmTransaction with same parameters</li>
                    <li>
                        If the response is error 400: 4 "Coupon Already Used", and the PartnerTransactionId (this is the
                        parameter that the Online Provider has to set in the ConfirmTransaction call in order to check
                        the transaction status later) in additional data matches the one that was sent – the coupon can
                        be confirmed on the Online Provider side and the transaction can be processed
                    </li>
                </ol>
                <p>
                    Alternatively:
                </p>
                <ol>
                    <li>Call method ValidateCoupon with required parameters</li>
                    <li>
                        If the coupon was used (IsValid == false) and ProviderTransactionId parameter matches the one
                        that was being currently sent in ConfirmTransaction, the coupon can be confirmed on the Online
                        Provider side and the transaction can be processed
                    </li>
                    <li>
                        If the coupon is valid (IsValid == true) and ProviderTransactionId is empty - the transaction was
                        not processed on the A-bon side, and you should call ConfirmTransaction again
                    </li>
                </ol>
                <br />
                <h4>ValidateCoupon method – invalid or no response</h4>
                <p>In case the Online Provider doesn't get a response, the request can be retried.</p>
            </div>
        </div>
    </div>

    <!-- #modal-dialog -->
    <div class="modal fade" id="couponModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">A-bon example</h4>
                </div>
                <div class="modal-body" align="center">
                    <img src="../../images/abon.png" alt="A-bon">
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-white" data-dismiss="modal">Close</a>
                </div>
            </div>
        </div>
    </div>

</body>
</html>