<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body>
    <div style="width: 50%">
        <div class="chapter">
            <div class="intro-container" style="">
                <h1>Intro</h1>
                <span class="text-wrap" style="width: 50%;display:inline-block; vertical-align: top">
                    <p>
                        Aircash a-bon is a platform intended for users that wish to make
                        payments to their Online Provider accounts (betting sites, parking
                        services, GSM topups etc.) via paper coupons that can be bought at
                        cash registers, i.e. points of sale of Aircash Sales Partners (kiosks, gas
                        stations, etc.). The process of using Aircash a-bon can be observed
                        from two perspectives: Sales Partner and Online Provider.
                    </p>
                    <p>
                        From the Sale Partner's perspective: the user comes to the cash
                        register at a Sale Partner point of sale and asks to buy an Aircash a-bon
                        coupon of a specific value. The cash register system then contacts the
                        Aircash backend system which then creates a coupon of the desired
                        value. After that, the user pays for that amount, and the cash register
                        prints out an Aircash a-bon coupon which is then given to the user.
                    </p>
                    <p>
                        From the Online Provider's perspective: the user logs in to a website or
                        a mobile app of an Online Provider (e.g. a booking site), and chooses to
                        deposit money via an Aircash a-bon coupon. He enters the 16-digit
                        code from the coupon he bought, and confirms the transaction of
                        funds to an Online Provider account. The funds are deposited to the
                        user's online account, and the coupon gets expended and can no
                        longer be used.
                    </p>
                    <p>
                        An example of an Aircash a-bon is shown on Image 1.
                    </p>
                </span>
                <span style="margin-left: 50px; display: inline-block">
                    <div>
                        <img src="././images/abonExample.png" style="max-width: 200px" />
                    </div>
                    <div>
                        <p style="max-width: 200px; text-align: center">
                            Image 1 - A-bon coupon
                        </p>
                    </div>
                </span>
            </div>
        </div>
        <hr />
        <div class="chapter">
            <div class="technical-integration-aspects-container">
                <h1>Technical integration aspects</h1>
                <span class="text-wrap" style="display:inline-block; vertical-align: top">
                    <br />
                    <h4>Security and authentication</h4>
                    <p>
                        Aircash a-bon system exposes a REST web API.
                    </p>
                    <p>
                        The API is accessed via HTTPS protocol (secured by a TLS certificate). Optionally, we can ensure access to
                        the API through a VPN.
                    </p>
                    <p>
                        Each request towards Aircash a-bon API has to be digitally signed. This ensures non-repudiation of every
                        request, as well as authentication.
                    </p>
                    <p>
                        Certificates used for signing are generated as described in the next chapter. The same certificate is used
                        to access both Aircash and a-bon services.
                    </p>
                    <p>
                        Each method has a special ProviderId parameter. This is a GUID type parameter that's generated by the
                        Aircash team and delivered to each Online Provider separately.
                    </p>
                    <p>
                        The partners are provided with an integration environment (staging) where it is possible to test all of the
                        methods for integration. All the integration details of the Aircash and a-bon services are described in
                        detail in the following chapters.
                    </p>

                    <br />
                    <h4>Checkbox – I accept A-bon Terms & Conditions</h4>
                    <p>
                        In order for the users to use A-bon services on the Online Provider's website, they have to accept the
                        terms and conditions beforehand.
                    </p>
                    <p>
                        Every Online Provider is obliged to add a checkbox for the A-bon terms and conditions, which is by
                        default always checked.
                    </p>
                    <p>
                        The checkbox has to contain a link to A-bon Terms and Conditions:
                    </p>
                    <code>
                        &lta href="https://aircash.eu/terms-conditions/opci-uvjeti-poslovanja-a-bon-elektronicki-novac/" rel="nofollow"&gtI accept the A-bon Terms&Conditions&lt/a&gt
                    </code>
                </span>
            </div>
        </div>
        <hr />
        <div class="chapter">
            <div class="online-provider-api-container">
                <h1>Online Provider API</h1>
                <span class="text-wrap" style="display:inline-block; vertical-align: top">
                    <br />
                    <h4>ValidateCoupon</h4>
                    <p>
                        ValidateCoupon method allows you to check the coupon status, value and whether it is valid. Once you
                        check the coupon validity and in case it is valid, you can call the ConfirmTransaction method to use that
                        coupon.
                    </p>
                    <p>
                        URL: /rest/api/OnlineProvider/ValidateCoupon
                    </p>
                    <p>
                        <i>Request:</i>
                    </p>
                    <table class="table table-active table-bordered">
                        <tr>
                            <th>Parameters</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Required</th>
                        </tr>
                        <tr>
                            <td><b>CouponCode</b></td>
                            <td>string</td>
                            <td>
                                16 digit coupon code that the user enters in the Online
                                Provider's web interface
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>ProviderId</b></td>
                            <td>string</td>
                            <td>
                                Unique provider identifier
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>Signature</b></td>
                            <td>string</td>
                            <td>
                                A sequence that has been digitally signed with the
                                provider's private signature, used for authentication
                            </td>
                            <td>YES</td>
                        </tr>
                    </table>
                    <p>
                        <i>Request example:</i>
                    </p>
                    <pre>
                    <code>{</code>
                    <code>    "couponCode": "12345678987654321",</code>
                    <code>    "providerId": "33352406-f672-4c27-a415-e26eb3ecd691",</code>
                    <code>    "signature": "12345....abc"</code>
                    <code>}</code>
                    </pre>
                    <br />
                    <p>
                        <i>200 OK Response:</i>
                    </p>
                    <table class="table table-active table-bordered">
                        <tr>
                            <th>Parameters</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td><b>CouponValue</b></td>
                            <td>decimal</td>
                            <td>
                                Coupon value
                            </td>
                        </tr>
                        <tr>
                            <td><b>IsValid</b></td>
                            <td>bool</td>
                            <td>
                                Status of the coupon's validity
                            </td>
                        </tr>
                        <tr>
                            <td><b>ISOCurrency</b></td>
                            <td>string</td>
                            <td>
                                ISO 4217 code of currency
                            </td>
                        </tr>
                        <tr>
                            <td><b>ProviderTransactionId</b></td>
                            <td>string</td>
                            <td>
                                Transaction identifier in the Online Provider system (has value
                                only if the coupon has been used)
                            </td>
                        </tr>
                        <tr>
                            <td><b>OriginalCouponValue</b></td>
                            <td>decimal</td>
                            <td>
                                Coupon value in the currency that the coupon was originally
                                bought in
                            </td>
                        </tr>
                        <tr>
                            <td><b>OriginalISOCurrency</b></td>
                            <td>string</td>
                            <td>
                                ISO 4217 code of the currency that the coupon was originally
                                bought in
                            </td>
                        </tr>
                    </table>
                    <p>
                        <i>200 OK Response example:</i>
                    </p>
                    <pre>
                    <code>{</code>
                    <code>    "couponValue": 50.0,</code>
                    <code>    "isValid": true,</code>
                    <code>    "ISOCurrency": "HRK"</code>
                    <code>    "providerTransactionId": "d0e19ce2-df5f-48d0-8520-7513618a6d72",</code>
                    <code>    "originalCouponValue": 50.0,</code>
                    <code>    "originalISOCurrency": "HRK"</code>
                    <code>}</code>
                    </pre>
                    <br />
                    <p>
                        <i>Error responses:</i>
                    </p>
                    <table class="table table-active table-bordered">
                        <tr>
                            <th>Http response</th>
                            <th>Description</th>
                            <th>Solution</th>
                        </tr>
                        <tr>
                            <td><b>401</b></td>
                            <td>
                                In case the provider sends an
                                unknown provider ID or invalid
                                signature a-bon system will return this
                                response
                            </td>
                            <td>
                                Verify that ProviderId and Signature are
                                correct in your request.
                            </td>
                        </tr>
                        <tr>
                            <td><b>400</b></td>
                            <td>An invalid request was made</td>
                            <td>
                                The response will contain an error code,
                                message and optionally additionalData. See
                                "400 Error response" table for possible 400
                                responses
                            </td>
                        </tr>
                        <tr>
                            <td><b>500</b></td>
                            <td>An unknown error occured</td>
                            <td>
                                Contact a-bon support
                            </td>
                        </tr>
                    </table>
                    <br />
                    <p>
                        <i>400 Error responses:</i>
                    </p>
                    <table class="table table-active table-bordered">
                        <tr>
                            <th>Code</th>
                            <th>Message</th>
                            <th>Additional data</th>
                        </tr>
                        <tr>
                            <td><b>1</b></td>
                            <td>
                                "Invalid ProviderId" – wrong partner identifier (ProviderId)
                            </td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><b>2</b></td>
                            <td>"Invalid Signature" – wrong request signature (SignedData)</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><b>3</b></td>
                            <td>"Invalid Coupon Code" – wrong coupon code</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><b>4</b></td>
                            <td>"Conversion Module Error" – error in currency conversion module</td>
                            <td>-</td>
                        </tr>
                    </table>
                    <p>
                        <i>400 Error response example:</i>
                    </p>
                    <pre>
                    <code>{</code>
                    <code>    "code": 1,</code>
                    <code>    "message": "Invalid ProviderId",</code>
                    <code>    "additionalData": null</code>
                    <code>}</code>
                    </pre>
                    <br />
                    <h4>ConfirmTransaction</h4>
                    <p>
                        Method that’s used to confirm the transfer of funds to the user’s online account.
                    </p>
                    <p>
                        URL: /rest/api/OnlineProvider/ConfirmTransaction
                    </p>
                    <p>
                        <i>Request:</i>
                    </p>
                    <table class="table table-active table-bordered">
                        <tr>
                            <th>Parameters</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Required</th>
                        </tr>
                        <tr>
                            <td><b>CouponCode</b></td>
                            <td>string</td>
                            <td>
                                16 digit coupon code that the user enters in the Online
                                Provider's web interface
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>ProviderId</b></td>
                            <td>string</td>
                            <td>
                                Unique provider identifier
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>ProviderTransactionId</b></td>
                            <td>string</td>
                            <td>
                                Transaction identifier in the Online Provider system
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>UserId</b></td>
                            <td>string</td>
                            <td>
                                Unique user identifier in the Online Provider system
                            </td>
                            <td>YES</td>
                        </tr>
                        <tr>
                            <td><b>Signature</b></td>
                            <td>string</td>
                            <td>
                                A sequence that has been digitally signed with the
                                provider's private signature, used for authentication
                            </td>
                            <td>YES</td>
                        </tr>
                    </table>
                    <p>
                        <i>Request example:</i>
                    </p>
                    <pre>
                    <code>{</code>
                    <code>    "couponCode": "12345678987654321",</code>
                    <code>    "providerId": "33352406-f672-4c27-a415-e26eb3ecd691",</code>
                    <code>    "providerTransactionId": "d0e19ce2-df5f-48d0-8520-7513618a6d72",</code>
                    <code>    "userId": "testusername",</code>
                    <code>    "signature": "12345....abc"</code>
                    <code>}</code>
                    </pre>
                    <br />
                    <p>
                        <i>200 OK Response:</i>
                    </p>
                    <table class="table table-active table-bordered">
                        <tr>
                            <th>Parameters</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td><b>CouponValue</b></td>
                            <td>decimal</td>
                            <td>
                                Coupon value
                            </td>
                        </tr>
                        <tr>
                            <td><b>ISOCurrency</b></td>
                            <td>string</td>
                            <td>
                                ISO 4217 code of the currency
                            </td>
                        </tr>
                        <tr>
                            <td><b>ProviderTransactionId</b></td>
                            <td>string</td>
                            <td>
                                Transaction identifier in the Online Provider system (has value
                                only if the coupon has been used)
                            </td>
                        </tr>
                    </table>
                    <p>
                        <i>200 OK Response example:</i>
                    </p>
                    <pre>
                    <code>{</code>
                    <code>    "couponValue": 50.0,</code>
                    <code>    "ISOCurrency": "HRK"</code>
                    <code>    "providerTransactionId": "33352406-f672-4c27-a415-e26eb3ecd691",</code>
                    <code>}</code>
                    </pre>
                    <br />
                    <p>
                        <i>Error responses:</i>
                    </p>
                    <table class="table table-active table-bordered">
                        <tr>
                            <th>Http response</th>
                            <th>Description</th>
                            <th>Solution</th>
                        </tr>
                        <tr>
                            <td><b>401</b></td>
                            <td>
                                In case the provider sends an
                                unknown provider ID or invalid
                                signature a-bon system will return this
                                response
                            </td>
                            <td>
                                Verify that ProviderId and Signature are
                                correct in your request.
                            </td>
                        </tr>
                        <tr>
                            <td><b>400</b></td>
                            <td>An invalid request was made</td>
                            <td>
                                The response will contain an error code,
                                message and optionally additionalData. See
                                "400 Error response" table for possible 400
                                responses
                            </td>
                        </tr>
                        <tr>
                            <td><b>500</b></td>
                            <td>An unknown error occured</td>
                            <td>
                                Contact a-bon support
                            </td>
                        </tr>
                    </table>
                    <br />
                    <p>
                        <i>400 Error responses:</i>
                    </p>
                    <table class="table table-active table-bordered">
                        <tr>
                            <th>Code</th>
                            <th>Message</th>
                            <th>Additional data</th>
                        </tr>
                        <tr>
                            <td><b>1</b></td>
                            <td>
                                "Invalid ProviderId" – wrong partner identifier (ProviderId)
                            </td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><b>2</b></td>
                            <td>"Invalid Signature" – wrong request signature (SignedData)</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><b>3</b></td>
                            <td>"Invalid Coupon Code" – wrong coupon code</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><b>4</b></td>
                            <td>"Coupon Already Used" – coupon already used</td>
                            <td>
                                I SOCurrency
                                CouponValue
                                ProviderTransactionId
                            </td>
                        </tr>
                        <tr>
                            <td><b>5</b></td>
                            <td>"Conversion Module Error" – error in currency conversion module</td>
                            <td>-</td>
                        </tr>
                    </table>
                    <p>
                        <i>400 Error response example:</i>
                    </p>
                    <pre>
                    <code>{</code>
                    <code>    "code": 4,</code>
                    <code>    "message": "Invalid Coupon Code",</code>
                    <code>    "additionalData": {</code>
                    <code>            "couponValue": 50.0,</code>
                    <code>            "ISOCurrency": "HRK",</code>
                    <code>            "providerTransactionId": "33352406-f672-4c27-a415-e26eb3ecd691",</code>
                    <code>    }</code>
                    <code>}</code>
                    </pre>
                </span>
            </div>
        </div>
        <hr />
        <div class="chapter">
            <div class="technical-integration-aspects-container">
                <h1>Edge cases</h1>
                <span class="text-wrap" style="display:inline-block; vertical-align: top">
                    <br />
                    <h4>ConfirmTransaction method – invalid or no response</h4>
                    <p>
                        In the case of an unsuccessful ConfirmTransaction call, the following error recovery methods should be
                        applied:
                    </p>
                    <ol>
                        <li>Call ConfirmTransaction with same parameters</li>
                        <li>
                            If the response is error 400: 4 "Coupon Already Used", and the PartnerTransactionId (this is the
                            parameter that the Online Provider has to set in the ConfirmTransaction call in order to check
                            the transaction status later) in additional data matches the one that was sent – the coupon can
                            be confirmed on the Online Provider side and the transaction can be processed
                        </li>
                    </ol>
                    <p>
                        Alternatively:
                    </p>
                    <ol>
                        <li>Call method ValidateCoupon with required parameters</li>
                        <li>
                            If the coupon was used (IsValid == false) and ProviderTransactionId parameter matches the one
                            that was being currently sent in ConfirmTransaction, the coupon can be confirmed on the Online
                            Provider side and the transaction can be processed
                        </li>
                        <li>
                            If the coupon is valid (IsValid == true) and ProviderTransactionId is empty - the transaction was
                            not processed on the A-bon side, and you should call ConfirmTransaction again
                        </li>
                    </ol>
                    <br />
                    <h4>ValidateCoupon method – invalid or no response</h4>
                    <p>In case the Online Provider doesn't get a response, the request can be retried.</p>
                </span>
            </div>
        </div>
    </div>
</body>
</html>